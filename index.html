<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Agent 查询 (ES5)</title>
    <style>
      /* 简洁的样式，兼容旧浏览器 */
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 24px; background: #f7f7f8; color: #222; }
      h1 { font-size: 20px; margin: 0 0 16px; }
      .card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
      .row { display: block; margin: 6px 0; }
      .label { display: inline-block; width: 100px; color: #666; }
      .value { display: inline-block; color: #111; }
      textarea, input[type="text"] { width: 100%; box-sizing: border-box; padding: 8px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
      button { padding: 8px 12px; border: 1px solid #333; background: #fff; border-radius: 6px; cursor: pointer; font-size: 14px; }
      button:hover { background: #f0f0f0; }
      .actions { margin-top: 10px; }
      .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; word-wrap: break-word; }
    </style>
  </head>
  <body>
    <h1>User Agent 查询（ES5 兼容）</h1>

    <div class="card" id="currentUABox">
      <div class="row"><span class="label">当前 UA</span><span class="value mono" id="uaText"></span></div>
      <div class="row"><span class="label">浏览器</span><span class="value" id="browser"></span></div>
      <div class="row"><span class="label">版本</span><span class="value" id="version"></span></div>
      <div class="row"><span class="label">系统</span><span class="value" id="os"></span></div>
      <div class="row"><span class="label">设备</span><span class="value" id="device"></span></div>
      <div class="row"><span class="label">内核</span><span class="value" id="engine"></span></div>
      <div class="actions">
        <button id="copyBtn">复制 UA</button>
        <button id="refreshBtn">刷新</button>
      </div>
    </div>

    <div class="card">
      <div class="row" style="margin-bottom:8px;">输入一个 UA 字符串进行解析：</div>
      <textarea id="customUA" rows="3" placeholder="粘贴或输入 UA 字符串"></textarea>
      <div class="actions">
        <button id="parseBtn">解析输入的 UA</button>
        <button id="resetBtn">重置为当前 UA</button>
      </div>
    </div>

    <script>
      // ES5 兼容的 UA 解析器（基于常见模式，结果仅供参考）
      (function () {
        function getUAString() {
          // navigator.userAgent 在 ES5 环境可用
          return navigator.userAgent || '';
        }

        function includes(haystack, needle) {
          return haystack.indexOf(needle) !== -1;
        }

        function matchVersion(ua, token) {
          // 从 UA 中提取 "token/版本" 或 "token 版本" 的版本号
          var regex = new RegExp(token + "[\\/ ]([\\d_.]+)");
          var m = ua.match(regex);
          return m && m[1] ? m[1].replace(/_/g, '.') : '';
        }

        function detectBrowser(ua) {
          // 优先级：Edge(Chromium) -> Edge(Legacy) -> Opera -> Chrome -> Firefox -> Safari -> IE -> 其他
          if (includes(ua, 'Edg/')) {
            return { name: 'Edge (Chromium)', version: matchVersion(ua, 'Edg') };
          }
          if (includes(ua, 'Edge/')) {
            return { name: 'Edge (Legacy)', version: matchVersion(ua, 'Edge') };
          }
          if (includes(ua, 'OPR/')) {
            return { name: 'Opera', version: matchVersion(ua, 'OPR') };
          }
          if (includes(ua, 'Chrome/')) {
            return { name: 'Chrome', version: matchVersion(ua, 'Chrome') };
          }
          if (includes(ua, 'Firefox/')) {
            return { name: 'Firefox', version: matchVersion(ua, 'Firefox') };
          }
          // Safari: 需要排除包含 Chrome 的情况，且通常配合 Version/
          if (includes(ua, 'Safari') && !includes(ua, 'Chrome')) {
            var ver = matchVersion(ua, 'Version');
            return { name: 'Safari', version: ver || matchVersion(ua, 'Safari') };
          }
          // IE
          if (includes(ua, 'MSIE ')) {
            return { name: 'Internet Explorer', version: matchVersion(ua, 'MSIE') };
          }
          if (includes(ua, 'Trident/')) {
            // IE11: rv:11.0; Trident/7.0
            var rvMatch = ua.match(/rv:([\d.]+)/);
            return { name: 'Internet Explorer', version: rvMatch && rvMatch[1] ? rvMatch[1] : '' };
          }
          return { name: 'Unknown', version: '' };
        }

        function detectOS(ua) {
          if (includes(ua, 'Windows NT')) {
            var ver = ua.match(/Windows NT ([\d.]+)/);
            var map = {
              '10.0': 'Windows 10/11',
              '6.3': 'Windows 8.1',
              '6.2': 'Windows 8',
              '6.1': 'Windows 7',
              '6.0': 'Windows Vista',
              '5.1': 'Windows XP'
            };
            var k = ver && ver[1] ? ver[1] : '';
            return 'Windows ' + (map[k] || k);
          }
          if (includes(ua, 'Mac OS X')) {
            var m = ua.match(/Mac OS X ([\d_]+)/);
            return 'macOS ' + (m && m[1] ? m[1].replace(/_/g, '.') : '');
          }
          if (includes(ua, 'iPhone') || includes(ua, 'iPad') || includes(ua, 'iPod')) {
            var v = ua.match(/OS ([\d_]+) like Mac OS X/);
            return 'iOS ' + (v && v[1] ? v[1].replace(/_/g, '.') : '');
          }
          if (includes(ua, 'Android')) {
            return 'Android ' + matchVersion(ua, 'Android');
          }
          if (includes(ua, 'Linux')) {
            return 'Linux';
          }
          return 'Unknown';
        }

        function detectDevice(ua) {
          if (includes(ua, 'Mobile')) {
            if (includes(ua, 'iPhone')) return 'iPhone';
            if (includes(ua, 'Android')) return 'Android 手机';
            return '手机';
          }
          if (includes(ua, 'iPad')) return 'iPad';
          if (includes(ua, 'Tablet')) return '平板';
          return '桌面/其他';
        }

        function detectEngine(ua) {
          if (includes(ua, 'Trident/')) return 'Trident';
          if (includes(ua, 'Gecko/') && includes(ua, 'Firefox/')) return 'Gecko';
          // Blink 通常在 Chrome/Edge/Opera 的现代 UA 中，但不直接出现；用特征判断
          if (includes(ua, 'Chrome/') || includes(ua, 'Edg/') || includes(ua, 'OPR/')) return 'Blink/WebKit';
          if (includes(ua, 'Safari/') && !includes(ua, 'Chrome/')) return 'WebKit';
          return 'Unknown';
        }

        function parseUA(ua) {
          var browser = detectBrowser(ua);
          var os = detectOS(ua);
          var device = detectDevice(ua);
          var engine = detectEngine(ua);
          return {
            ua: ua,
            browser: browser.name,
            version: browser.version,
            os: os,
            device: device,
            engine: engine
          };
        }

        function byId(id) { return document.getElementById(id); }

        function render(info) {
          byId('uaText').innerHTML = info.ua;
          byId('browser').innerHTML = info.browser;
          byId('version').innerHTML = info.version || '-';
          byId('os').innerHTML = info.os;
          byId('device').innerHTML = info.device;
          byId('engine').innerHTML = info.engine;
        }

        function init() {
          var ua = getUAString();
          render(parseUA(ua));

          byId('copyBtn').onclick = function () {
            // 复制 UA 到剪贴板（旧方案，兼容性更好）
            var textarea = document.createElement('textarea');
            textarea.value = byId('uaText').innerHTML;
            textarea.style.position = 'fixed';
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
            try { document.execCommand('copy'); } catch (e) {}
            document.body.removeChild(textarea);
          };

          byId('refreshBtn').onclick = function () {
            var cur = getUAString();
            render(parseUA(cur));
            byId('customUA').value = '';
          };

          byId('parseBtn').onclick = function () {
            var custom = byId('customUA').value || '';
            if (custom.replace(/\s/g, '').length === 0) {
              render(parseUA(getUAString()));
            } else {
              render(parseUA(custom));
            }
          };

          byId('resetBtn').onclick = function () {
            byId('customUA').value = '';
            render(parseUA(getUAString()));
          };
        }

        // DOMContentLoaded 在 ES5 环境中可用于现代浏览器；为稳妥也挂载到 onload
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', init);
          window.addEventListener('load', init);
        } else {
          init();
        }
      })();
    </script>
  </body>
  </html>
