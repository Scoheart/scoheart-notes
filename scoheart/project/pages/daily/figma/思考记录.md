# D2C

应对场景：

- ToC 场景：在 ToC 的场景下，我们的 Web 页面在日/周/月抛方面的比例极大（例如当前实施落地的运营方向的项目），多数是展示类型的界面，「组件识别」的需求低，但是对「布局还原」和「图片转换」的需求极高，代码可维护性要求也不高。所以，ToC 场景下以 absolute 布局还原方式为主导的 D2C 方案是可行的。

- ToB 场景：在 ToB 的场景下，多数为中后台项目，管理系统等页面风格较为统一，「组件识别」的需求极高，「布局还原」和「图片转换」的需求占比相对较低，后期的可维护性非常重要。必须要精确的进行组件识别（或对应到某个 component lib）。所以，ToB 场景下以 flex 布局还原，组件封装使用为主导的 D2C 方案是必需的。

在我们的 D2C，如果要实现生产环境可用的 D2C 方案，应该至少具备以下能力：

- 设计稿要做到像素级的还原，还原度应该达到 100%（但是不能仅仅通过绝对定位的方式来实现 100%的布局还原）
- 需要有组件维度的还原，即如何识别一个组件，以及其设计形态对应的 API，降低二次开发的成本
- D2C 的最终的代码产物，应该需要一定程度的代码抽象，如何更像人写的代码，产物可维护性更高
  - 组件（含变体-通过 props 实现）的定义，复用
  - 样式代码的复用，冗余去除
  - 样式变量的定义，提取

# 布局还原

目前 Web 前端主流的 CSS 布局方案为：static、absolute、flex、grid 布局，而对应在 Figma 中，其布局方案为：absolute、auto layout（flex）。

- 如果为 auto layout 则转换为 flex 布局
- 实现 figma 的部分 absolute 转换到 flex 布局
- 特定情况下依旧采用 absolute 布局
- 响应式方案，以及设计稿转换比例问题

# 组件识别

- 人工标注
- 机器学习 CV
- C2D2C （semi design）
- Figma 组件

# 图片转换的规则

1. 当一个图层的类型为如下的节点的时候，该图层被「直接」转换成图片
2. 当一个图层的所有的子图层的类型为如下的节点的时候，该图层被「整体」转换成图片

```ts
type ImageifyNode =
  | BooleanOperationNode
  | VectorNode
  | StarNode
  | LineNode
  | EllipseNode
  | PolygonNode;
```

3. 当图层设置了 exports 的时候，该图层被「整体」转换成图片
4. mask

## Q&A

- Rectangle 节点的转换规则
- 设计规范：设计师可以自己标注图层是不是该导出（完全借用 Figma 的能力，无需打标）
